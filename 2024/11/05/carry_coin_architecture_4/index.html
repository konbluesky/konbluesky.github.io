<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Carry-Coin 架构设计 SymbolLedger (4) - Gavin&#039;s Home</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Gavin&#039;s Home"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Gavin&#039;s Home"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Carry-Coin 套利币本 SymbolLedger 设计，SymbolLedger负责存放套利过程中交易对信息，其中包括symbol在Cex中的各项配置、套利阈值等，Dex中的各种合约信息、阈值、交易参数等"><meta property="og:type" content="blog"><meta property="og:title" content="Carry-Coin 架构设计 SymbolLedger (4)"><meta property="og:url" content="https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/"><meta property="og:site_name" content="Gavin&#039;s Home"><meta property="og:description" content="Carry-Coin 套利币本 SymbolLedger 设计，SymbolLedger负责存放套利过程中交易对信息，其中包括symbol在Cex中的各项配置、套利阈值等，Dex中的各种合约信息、阈值、交易参数等"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/SymbolLedger.png"><meta property="article:published_time" content="2024-11-05T09:03:42.000Z"><meta property="article:modified_time" content="2024-11-05T14:47:33.000Z"><meta property="article:author" content="Gavin"><meta property="article:tag" content="Java"><meta property="article:tag" content="Python"><meta property="article:tag" content="Architecture"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/SymbolLedger.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/"},"headline":"Carry-Coin 架构设计 SymbolLedger (4)","image":["https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/SymbolLedger.png"],"datePublished":"2024-11-05T09:03:42.000Z","dateModified":"2024-11-05T14:47:33.000Z","author":{"@type":"Person","name":"Gavin"},"publisher":{"@type":"Organization","name":"Gavin's Home","logo":{"@type":"ImageObject","url":{"text":"Gavin's Home"}}},"description":"Carry-Coin 套利币本 SymbolLedger 设计，SymbolLedger负责存放套利过程中交易对信息，其中包括symbol在Cex中的各项配置、套利阈值等，Dex中的各种合约信息、阈值、交易参数等"}</script><link rel="canonical" href="https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Gavin&#039;s Home</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/konbluesky"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-11-05T09:03:42.000Z" title="11/5/2024, 5:03:42 PM">2024-11-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-11-05T14:47:33.000Z" title="11/5/2024, 10:47:33 PM">2024-11-05</time></span><span class="level-item"><a class="link-muted" href="/categories/CarryCoin/">CarryCoin</a></span><span class="level-item">20 minutes read (About 2998 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Carry-Coin 架构设计 SymbolLedger (4)</h1><div class="content"><p>Carry-Coin 套利币本 SymbolLedger 设计，SymbolLedger负责存放套利过程中交易对信息，其中包括symbol在Cex中的各项配置、套利阈值等，Dex中的各种合约信息、阈值、交易参数等</p>
<span id="more"></span>

<img src="/2024/11/05/carry_coin_architecture_4/SymbolLedger.png" class="">
<h2 id="SymbolLedger"><a href="#SymbolLedger" class="headerlink" title="SymbolLedger"></a>SymbolLedger</h2><p>一个交易所对应一个SymbolLedger实例,程序启动后通过json配置文件进行加载；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> * 此类用来存储市面上所有的交易对信息</span><br><span class="line"> * 维护方式: 基础信息手工,其他信息通过程序自动获取;</span><br><span class="line"> * 更新周期: 定期更新;</span><br><span class="line"> * 作用: 以此账簿上的币作为循化基础,再从各交易所拉取对应信息;</span><br><span class="line"> * &lt;/pre&gt;</span><br><span class="line"> * &lt;p&gt; @Date : 2023/3/21 &lt;/p&gt;</span><br><span class="line"> * &lt;p&gt; @Project : block-farming&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt; @author konbluesky &lt;/p&gt;</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Data</span><br><span class="line">public class SymbolLedger &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 如是内存模式则不进行数据库持久化</span><br><span class="line">     */</span><br><span class="line">    private boolean memoryMode = false;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新symbolPairConfigs时,一定要重新对symbolPairConfigMap和symbolPairConfigMap_symbolKey进行更新</span><br><span class="line">     * 否则getSymbolPairConfig会失效</span><br><span class="line">     * @param symbolPairConfigs</span><br><span class="line">     */</span><br><span class="line">    public void setSymbolPairConfigs(List&lt;SymbolPairConfig&gt; symbolPairConfigs) &#123;</span><br><span class="line">        this.symbolPairConfigs = symbolPairConfigs;</span><br><span class="line">        for(SymbolPairConfig symbolPairConfig : symbolPairConfigs)&#123;</span><br><span class="line">            updateSymbolPairConfig(symbolPairConfig);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(&quot;SymbolLedger更新symbolPairConfigs&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private List&lt;SymbolPairConfig&gt; symbolPairConfigs = Lists.newCopyOnWriteArrayList();</span><br><span class="line"></span><br><span class="line">    private Map&lt;String, SymbolPairConfig&gt; symbolPairConfigMap = Maps.newConcurrentMap();</span><br><span class="line"></span><br><span class="line">    private Map&lt;String, SymbolPairConfig&gt; symbolPairConfigMap_symbolKey = Maps.newConcurrentMap();</span><br><span class="line">    //    private Table&lt;String, String, SymbolPairConfig&gt; symbolPairConfigMap = Tables.synchronizedTable(HashBasedTable.create());</span><br><span class="line"></span><br><span class="line">    public void put(SymbolPairConfig symbolPairConfig) &#123;</span><br><span class="line">        symbolPairConfigs.add(symbolPairConfig);</span><br><span class="line">        updateSymbolPairConfig(symbolPairConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void updateSymbolPairConfig(SymbolPairConfig symbolPairConfig)&#123;</span><br><span class="line">        CenterSymbolInfo centerSymbolInfo = symbolPairConfig.getCenterSymbolInfo();</span><br><span class="line">        symbolPairConfigMap.put(centerSymbolInfo.getBaseCurrency()</span><br><span class="line">                                                .toLowerCase(), symbolPairConfig);</span><br><span class="line">        symbolPairConfigMap_symbolKey.put(centerSymbolInfo.getBaseCurrency()</span><br><span class="line">                                                          .toLowerCase() + &quot;/&quot; + centerSymbolInfo.getQuoteCurrency()</span><br><span class="line">                                                                                                 .toLowerCase(), symbolPairConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Deprecated</span><br><span class="line">    public SymbolPairConfig getSymbolPairConfig(String baseCurrency) &#123;</span><br><span class="line">        return symbolPairConfigMap.get(baseCurrency.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;SymbolPairConfig&gt; getSymbolPairConfigsBy(String baseCurrency) &#123;</span><br><span class="line">        List&lt;SymbolPairConfig&gt; result = Lists.newArrayList();</span><br><span class="line">        symbolPairConfigMap_symbolKey.forEach((k, v) -&gt; &#123;</span><br><span class="line">            if(k.toLowerCase().startsWith(baseCurrency.toLowerCase())) &#123;</span><br><span class="line">                result.add(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SymbolPairConfig getSymbolPairConfig(String baseCurrency, String quoteCurrency) &#123;</span><br><span class="line">        return symbolPairConfigMap_symbolKey.get(baseCurrency.toLowerCase() + &quot;/&quot; + quoteCurrency.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SymbolLedger构建的静态工厂,json配置通过carry-config-generator(python)生成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> * 1. 交易对配置文件工厂,目前实现从HUOBI.txt文件中读取;</span><br><span class="line"> * 2. 可以在jar包所在目录下创建config目录,将配置文件放入config目录下,程序会自动读取;</span><br><span class="line"> * &lt;/pre&gt;</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class SymbolLedgerFactory &#123;</span><br><span class="line"></span><br><span class="line">    public static final String SYMBOL_HUOBI_BOOKS_FILE = &quot;HUOBI.txt&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String SYMBOL_XT_BOOKS_FILE = &quot;XT.txt&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String SYMBOL_BINANCE_BOOKS_FILE = &quot;BIAN.txt&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String SYMBOL_MEXC_BOOKS_FILE = &quot;MXCAll.txt&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String SYMBOL_GATEIO_BOOKS_FILE = &quot;GATEIO.txt&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String SYMBOL_KUCOIN_BOOKS_FILE = &quot;KUCOIN.txt&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * TODO 从文件中读取交易对配置,目前只解析部分字段;有需要实时更新的字段到时候从服务器上实时拉取;</span><br><span class="line">     * swapStableCoinContractAdd 字段配置决定了与交易所的对的匹配;</span><br><span class="line">     *</span><br><span class="line">     * @param symbolBooksFile</span><br><span class="line">     * @param swapConfig</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private static SymbolLedger create(String symbolBooksFile, SwapConfig swapConfig) &#123;</span><br><span class="line">        Preconditions.checkArgument(swapConfig != null);</span><br><span class="line">        JSONArray jsonArray = getJsonArrayByFile(symbolBooksFile);</span><br><span class="line">        SymbolLedger symbolLedger = new SymbolLedger();</span><br><span class="line">        for (int i = 0; i &lt; jsonArray.size(); i++) &#123;</span><br><span class="line">            JSONObject item = jsonArray.getJSONObject(i);</span><br><span class="line"></span><br><span class="line">            // continue to parse the json object</span><br><span class="line">            if (Strings.isNullOrEmpty(item.getString(&quot;swapContract&quot;)) || item.getString(&quot;swapStableCoinContract&quot;)</span><br><span class="line">                                                                             .equalsIgnoreCase(&quot;cake&quot;)) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SymbolPairConfig symbolPairConfig = new SymbolPairConfig();</span><br><span class="line">            symbolPairConfig.setBaseCurrency(item.getString(&quot;swapCoinContract&quot;));</span><br><span class="line"></span><br><span class="line">            int chainId = item.getInteger(&quot;chainId&quot;) != null ? item.getInteger(&quot;chainId&quot;) : NetworkEnum.BSC.getChainId();</span><br><span class="line">            String stableName = SymbolTokenHelper.getTokenInfoByAddressReturnSymbol(chainId, item.getString(&quot;swapStableCoinContractAdd&quot;));</span><br><span class="line"></span><br><span class="line">            symbolPairConfig.setQuoteCurrency(Currency.USDT.getCurrencyCode());</span><br><span class="line">            // symbolPairConfig.setSymbol(symbolPairConfig.getBaseCurrency() + &quot;/&quot; + symbolPairConfig.getQuoteCurrency());</span><br><span class="line"></span><br><span class="line">            // 链上交易对和cex交易对 分别存储,交易所对,目前统一使用usdt</span><br><span class="line">            CenterSymbolInfo centerSymbolInfo = new CenterSymbolInfo();</span><br><span class="line">            centerSymbolInfo.setBaseCurrency(symbolPairConfig.getBaseCurrency());</span><br><span class="line">            centerSymbolInfo.setQuoteCurrency(Currency.USDT.getCurrencyCode());</span><br><span class="line">            centerSymbolInfo.setCexMaxOrderForUSDT(item.getBigDecimal(&quot;maxOrderForUsdt&quot;) == null ? swapConfig.getGlobalMaxOrderForUsdt() : item.getBigDecimal(&quot;maxOrderForUsdt&quot;));</span><br><span class="line">            centerSymbolInfo.setCexMinOrderForUSDT(item.getBigDecimal(&quot;minOrderForUsdt&quot;) == null ? swapConfig.getGlobalMinOrderForUsdt() : item.getBigDecimal(&quot;minOrderForUsdt&quot;));</span><br><span class="line">            centerSymbolInfo.getAskPosition()</span><br><span class="line">                            .set(item.getInteger(&quot;askPosition&quot;) == null || item.getInteger(&quot;askPosition&quot;) == 0 ? 3 : item.getInteger(&quot;askPosition&quot;));</span><br><span class="line"></span><br><span class="line">            symbolPairConfig.setCenterSymbolInfo(centerSymbolInfo);</span><br><span class="line"></span><br><span class="line">            // 设置去中心化交易所配置信息;</span><br><span class="line">            DecenterSymbolInfo decenterSymbolInfo = new DecenterSymbolInfo();</span><br><span class="line">            decenterSymbolInfo.setBaseCurrency(symbolPairConfig.getBaseCurrency())</span><br><span class="line">                              .setQuoteCurrency(stableName == null ? CoinEnum.getCoin(item.getString(&quot;swapStableCoinContractAdd&quot;))</span><br><span class="line">                                                                             .name() : stableName)</span><br><span class="line">                              .setMiddleCurrency(item.getString(&quot;swapMiddleCoinContract&quot;))</span><br><span class="line">                              .setDexName(item.getString(&quot;dex_name&quot;))</span><br><span class="line">                              .setDexProtocolVersion(item.getString(&quot;liquidity_type&quot;))</span><br><span class="line">                              // 链id</span><br><span class="line">                              .setChainIds(Set.of(chainId))</span><br><span class="line">                              .setStableCoinContractAddress(item.getString(&quot;swapStableCoinContractAdd&quot;))</span><br><span class="line">                              .setMiddleCoinContractAddress(item.getString(&quot;swapMiddleCoinContractAdd&quot;))</span><br><span class="line">                              .setTradeCoinContractAddress(item.getString(&quot;swapCoinContractAdd&quot;))</span><br><span class="line">                              .setSwapContractAddress(item.getString(&quot;swapContract&quot;))</span><br><span class="line">                              .setBurnFee(item.getBigDecimal(&quot;burn&quot;))</span><br><span class="line">                              .setBuyTax(item.getBigDecimal(&quot;buyTax&quot;))// 买入税率</span><br><span class="line">                              .setSellTax(item.getBigDecimal(&quot;sellTax&quot;))//卖出税率</span><br><span class="line">                              // .setSellTax(item.getBigDecimal(&quot;burn&quot;))// 卖出税率， 老的配置文件中就是sellTax</span><br><span class="line">                              .setDexBuySlipPoint(item.getBigDecimal(&quot;dexSlipPoint&quot;)</span><br><span class="line">                                                      .add(swapConfig.getGlobalDexSlipPoint()))</span><br><span class="line">                              .setStableCoinDecimals(item.getIntValue(&quot;stableCoinDecimals&quot;))</span><br><span class="line">                              .setTradeCoinDecimals(item.getIntValue(&quot;coinDecimals&quot;))</span><br><span class="line">                              .setMiddleCoinDecimals(item.getIntValue(&quot;middleCoinDecimals&quot;))</span><br><span class="line">                              .setMethod(item.getString(&quot;method&quot;))</span><br><span class="line">                              .setBuyPosition(item.getIntValue(&quot;currentDepthPosition&quot;))</span><br><span class="line">                              .setReplyPro(item.getBigDecimal(&quot;replyPro&quot;)) // 反向利润放大的比例</span><br><span class="line">                              .setDepthPro(item.getBigDecimal(&quot;depthPro&quot;)) // 反向深度缩小的比例</span><br><span class="line">                              .setV3LoopContractAddress(item.getString(&quot;lpAdd&quot;)) // v3 的loopAddress</span><br><span class="line">                              .setV3Fee(item.getString(&quot;feev3&quot;)) // v3 的fee</span><br><span class="line">                              .setDexMaxOrderForUSDT(item.getBigDecimal(&quot;dexMax&quot;) == null ? swapConfig.getGlobalMaxOrderForUsdt() : item.getBigDecimal(&quot;dexMax&quot;)) // 反向最大下单量</span><br><span class="line">                              .setDexMinOrderForUSDT(item.getBigDecimal(&quot;dexMin&quot;) == null ? swapConfig.getGlobalMinOrderForUsdt() : item.getBigDecimal(&quot;dexMin&quot;));// 反向最小下单量</span><br><span class="line"></span><br><span class="line">            decenterSymbolInfo.setExtensionDexHandlerConfig(new ExtensionDexHandlerConfig(item));</span><br><span class="line"></span><br><span class="line">            decenterSymbolInfo.init();</span><br><span class="line">            symbolPairConfig.setDecenterSymbolInfo(decenterSymbolInfo);</span><br><span class="line">            symbolPairConfig.set_rawJson(item);</span><br><span class="line"></span><br><span class="line">            symbolLedger.put(symbolPairConfig);</span><br><span class="line">        &#125;</span><br><span class="line">        return symbolLedger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static JSONArray getJsonArrayByFile(String symbolHuobiBooksFile) &#123;</span><br><span class="line">        File configFile = PathUtil.stairsLoad(symbolHuobiBooksFile, &quot;config&quot;);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            if (configFile == null) &#123;</span><br><span class="line">                log.warn(&quot;Not fount SymbolBook config file.&#123;&#125;&quot;, symbolHuobiBooksFile);</span><br><span class="line">                String tempPath = System.getProperty(&quot;java.io.tmpdir&quot;) + System.currentTimeMillis();</span><br><span class="line">                String tempFile = Paths.get(tempPath, File.separator, symbolHuobiBooksFile)</span><br><span class="line">                                       .toString();</span><br><span class="line">                Resource resource = new ClassPathResource(symbolHuobiBooksFile);</span><br><span class="line">                InputStream initialStream = resource.getInputStream();</span><br><span class="line">                byte[] buffer = new byte[initialStream.available()];</span><br><span class="line">                initialStream.read(buffer);</span><br><span class="line">                configFile = new File(tempFile);</span><br><span class="line">                configFile.getParentFile()</span><br><span class="line">                          .mkdirs();</span><br><span class="line">                Files.write(buffer, configFile);</span><br><span class="line">                log.info(&quot;Loading default SymbolBook config file from classpath: &#123;&#125; &quot;, resource.getURL());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            String jsonContext = Joiner.on(&quot;&quot;)</span><br><span class="line">                                       .join(Files.readLines(configFile, Charsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            if (JSON.isValidArray(jsonContext)) &#123;</span><br><span class="line">                return JSON.parseObject(jsonContext, JSONArray.class);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage(), e);</span><br><span class="line">            throw new SwapException(&quot;SymbolBook config loading failed.&quot;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return new JSONArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createXT(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_XT_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createHuoBi() &#123;</span><br><span class="line">        return create(SYMBOL_HUOBI_BOOKS_FILE, new SwapConfig());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createGateio() &#123;</span><br><span class="line">        return create(SYMBOL_GATEIO_BOOKS_FILE, new SwapConfig());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createGateio(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_GATEIO_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createKucoin(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_KUCOIN_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createOKex() &#123;</span><br><span class="line">        return create(SYMBOL_HUOBI_BOOKS_FILE, new SwapConfig());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createOKex(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_HUOBI_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createHuoBi(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_HUOBI_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createBinance(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_BINANCE_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SymbolLedger createMEXC(SwapConfig swapConfig) &#123;</span><br><span class="line">        return create(SYMBOL_MEXC_BOOKS_FILE, swapConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将配置文件内容刷入db</span><br><span class="line">     * 外部通过SwapControlHolder 来对状态进行控制和判断</span><br><span class="line">     *</span><br><span class="line">     * @param symbolLedger</span><br><span class="line">     * @param exchangeType</span><br><span class="line">     * @param isMonitor    开关用来控制swapSymbolPairConfigRecord 记录默认是监听状态还是， 非监听状态，</span><br><span class="line">     *                     首次程序启动的时候是非监听的，需要web端显式的开启，后续job中动态调整默认都是监听状态的</span><br><span class="line">     */</span><br><span class="line">    public static void flushToDb(SymbolLedger symbolLedger, ExchangeType exchangeType, boolean isMonitor) &#123;</span><br><span class="line">        if (symbolLedger.isMemoryMode()) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        SwapSymbolPairConfigRecordRepository res = SpringUtil.getBean(SwapSymbolPairConfigRecordRepository.class);</span><br><span class="line">        res.deleteAllByExchangeType(exchangeType);</span><br><span class="line">        res.flush();</span><br><span class="line">        List&lt;SwapSymbolPairConfigRecord&gt; all = Lists.newArrayList();</span><br><span class="line">        symbolLedger.getSymbolPairConfigs().forEach(symbolPairConfig -&gt; &#123;</span><br><span class="line">            SwapSymbolPairConfigRecord swapSymbolPairConfigRecord = null;</span><br><span class="line">            if (isMonitor) &#123;</span><br><span class="line">                swapSymbolPairConfigRecord = SwapSymbolPairConfigRecord.createLoadMonitor(symbolPairConfig, exchangeType);</span><br><span class="line">                SwapControlManager.putItem(exchangeType, symbolPairConfig.getUniDexIdentify(), swapSymbolPairConfigRecord);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                swapSymbolPairConfigRecord = SwapSymbolPairConfigRecord.createUnMonitor(symbolPairConfig, exchangeType);</span><br><span class="line">                SwapControlManager.putItem(exchangeType, symbolPairConfig.getUniDexIdentify(), swapSymbolPairConfigRecord);</span><br><span class="line">            &#125;</span><br><span class="line">            all.add(swapSymbolPairConfigRecord);</span><br><span class="line">        &#125;);</span><br><span class="line">        res.saveAllAndFlush(all);</span><br><span class="line">        log.info(&quot;Load config from config file, Flush to db is ok !  Record size is :&#123;&#125; &quot;, all.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 增量更新配置文件</span><br><span class="line">     * 1. 数据库中载入当前交易所币配置</span><br><span class="line">     * 2. 从内存中获取当前交易所币配置</span><br><span class="line">     * 3. 比较数据库中不在内存的配置，更新状态</span><br><span class="line">     * 4. 将关闭的币种组装日志打印出来</span><br><span class="line">     */</span><br><span class="line">    public static void incrementalUpdate(SymbolLedger symbolLedger, ExchangeType exchangeType) &#123;</span><br><span class="line">        if (symbolLedger.isMemoryMode()) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        SwapSymbolPairConfigRecordRepository res = SpringUtil.getBean(SwapSymbolPairConfigRecordRepository.class);</span><br><span class="line">        List&lt;SwapSymbolPairConfigRecord&gt; all = res.findAllByExchangeType(exchangeType);</span><br><span class="line"></span><br><span class="line">        String changeCurrency = &quot;&quot;;</span><br><span class="line">        int closeCount = 0;</span><br><span class="line">        for (SwapSymbolPairConfigRecord swapSymbolPairConfigRecord : all) &#123;</span><br><span class="line">            String symbol = swapSymbolPairConfigRecord.getSymbol();</span><br><span class="line">            if (symbolLedger.getSymbolPairConfig(symbol.split(&quot;/&quot;)[0], symbol.split(&quot;/&quot;)[1]) == null) &#123;</span><br><span class="line">                swapSymbolPairConfigRecord.setMonitorStatus(SwapSymbolPairConfigRecord.MonitorStatus.UNMONITOR);</span><br><span class="line"></span><br><span class="line">                changeCurrency += symbol + &quot;,&quot;;</span><br><span class="line">                closeCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.saveAllAndFlush(all);</span><br><span class="line"></span><br><span class="line">        String msg = Utils.format(&quot;&#123;&#125; 交易所内存币本配置已过滤,总数:&#123;&#125; 关闭数量:&#123;&#125; 关闭币种:&#123;&#125;&quot;, exchangeType, all.size(), closeCount, changeCurrency);</span><br><span class="line">        log.info(msg);</span><br><span class="line">        SwapMessageSender.sendMessage(exchangeType, msg);</span><br><span class="line">        log.info(&quot;Incremental update config from config file, Flush to db is ok !  Record size is :&#123;&#125; &quot;, all.size());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>SymbolPairConfig 类, 用来存储某个交易对(ABC&#x2F;USDT)的配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt; @Date : 2023/3/21 &lt;/p&gt;</span><br><span class="line"> * &lt;p&gt; @Project : block-farming&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt; @author konbluesky &lt;/p&gt;</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class SymbolPairConfig &#123;</span><br><span class="line"></span><br><span class="line">    //TODO 现阶段 symbolInfo 是1-1关系</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易对在中心化交易所的信息</span><br><span class="line">     */</span><br><span class="line">    private CenterSymbolInfo centerSymbolInfo;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易对在去中心化交易所的信息</span><br><span class="line">     */</span><br><span class="line">    private DecenterSymbolInfo decenterSymbolInfo;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易对显示名称 BTC/USDT</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    public String getSymbol() &#123;</span><br><span class="line">        return baseCurrency+&quot;/&quot;+quoteCurrency;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * RITE/USDT-RITE/USDT-PancakeV2-UniV2</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getUniDexIdentify()&#123;</span><br><span class="line">        return centerSymbolInfo.getSymbol() + &quot;-&quot; + decenterSymbolInfo.getSymbol() + &quot;-&quot; + decenterSymbolInfo.getDexName() + &quot;-&quot; + decenterSymbolInfo.getDexProtocolVersion();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易对基础货币 BTC</span><br><span class="line">     */</span><br><span class="line">    private String baseCurrency;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易对报价货币 USDT</span><br><span class="line">     */</span><br><span class="line">    private String quoteCurrency;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 允许开启的实例数</span><br><span class="line">     */</span><br><span class="line">    private AtomicInteger reverseAllowInstanceNum = new AtomicInteger(1);</span><br><span class="line">    private AtomicInteger forwardAllowInstanceNum = new AtomicInteger(1);</span><br><span class="line">    /**</span><br><span class="line">     * 开启翻倍后，设置x分钟激情时间，进行翻倍</span><br><span class="line">     */</span><br><span class="line">    private AtomicLong reversePassionTime = new AtomicLong(0);</span><br><span class="line">    private AtomicLong forwardPassionTime = new AtomicLong(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易对的利润阈值,一般在交易所holder初始化的时候从SwapConfig获取;</span><br><span class="line">     * TODO 这里的阈值可基于全局的做覆盖;</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal profitThreshold;</span><br><span class="line">    private BigDecimal profitThresholdRate;</span><br><span class="line">    private BigDecimal _origin_profitThresholdRate;</span><br><span class="line">    private JSONObject _rawJson;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void setProfitThresholdRate(BigDecimal profitThresholdRate) &#123;</span><br><span class="line">        this.profitThresholdRate = profitThresholdRate;</span><br><span class="line">        this._origin_profitThresholdRate = profitThresholdRate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProfitThresholdRateDouble() &#123;</span><br><span class="line">        profitThresholdRate = profitThresholdRate.multiply(new BigDecimal(&quot;1.3&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void resetProfitThresholdRate() &#123;</span><br><span class="line">        profitThresholdRate = _origin_profitThresholdRate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 提现次数自增一次</span><br><span class="line">     * Increase WithdrawTime</span><br><span class="line">     */</span><br><span class="line">    public void increaseWithdrawTimes() &#123;</span><br><span class="line">        centerSymbolInfo.getLastWithdrawTime().set(System.currentTimeMillis());</span><br><span class="line">        centerSymbolInfo.increaseWithdrawTimes();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isMiddleCoin() &#123;</span><br><span class="line">        return !Strings.isNullOrEmpty(decenterSymbolInfo.getMiddleCoinContractAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSymbolNoOblique() &#123;</span><br><span class="line">        return getSymbol().replace(&quot;/&quot;, &quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>CenterSymbolInfo 类, 用来存储某个交易对(ABC&#x2F;USDT)的Cex配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt; @Date : 2023/3/20 &lt;/p&gt;</span><br><span class="line"> * &lt;p&gt; @Project : block-farming&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt; @author konbluesky &lt;/p&gt;</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@Slf4j</span><br><span class="line">public class CenterSymbolInfo &#123;</span><br><span class="line"></span><br><span class="line">    public String getSymbol() &#123;</span><br><span class="line">        return baseCurrency + &quot;/&quot; + quoteCurrency;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注意这里是[交易所]对应的基础货币 BTC</span><br><span class="line">     */</span><br><span class="line">    private String baseCurrency;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注意这里是[交易所]对应的交易对报价货币 USDT</span><br><span class="line">     */</span><br><span class="line">    private String quoteCurrency;</span><br><span class="line"></span><br><span class="line">    private Double price;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易所体现时一般需要指定链名或者网络名</span><br><span class="line">     */</span><br><span class="line">    private String chainName;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 提现次数</span><br><span class="line">     */</span><br><span class="line">    private AtomicInteger withdrawTimes = new AtomicInteger(0);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最小提现手续费</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal withdrawMinFee = BigDecimal.ZERO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 手续费换算成美元</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal withdrawMinFee$ = BigDecimal.ZERO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 传入实时的单价，计算出手续费绝对刀</span><br><span class="line">     * @param unitPrice</span><br><span class="line">     */</span><br><span class="line">    public void setWithdrawMinFee$(BigDecimal unitPrice) &#123;</span><br><span class="line">        this.withdrawMinFee$ = Utils.getScale(unitPrice.multiply(withdrawMinFee));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最后一次的提现时间</span><br><span class="line">     */</span><br><span class="line">    private AtomicLong lastWithdrawTime = new AtomicLong(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最后一次下卖单时间</span><br><span class="line">     */</span><br><span class="line">    private AtomicLong lastPlaceSellOrderTime = new AtomicLong(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    private AtomicLong lastPlaceBuyOrderTime = new AtomicLong(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 卖单默认位置,此位置是口语中的卖一卖二，不是数组下标</span><br><span class="line">     */</span><br><span class="line">    private AtomicInteger askPosition = new AtomicInteger(0);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 挂单检查时间(卖单)</span><br><span class="line">     */</span><br><span class="line">    private int askOrderWaitSeconds = 5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易所固定最大下单金额(usdt为单位)</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal CexMaxOrderForUSDT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易所固定最小下单金额(usdt为单位)</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal CexMinOrderForUSDT;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 留币时保存的卖出下单ID;</span><br><span class="line">     * remain 留存  sell 出售 orderId 订单ID</span><br><span class="line">     */</span><br><span class="line">    private String remainSellOrderId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 提现次数自增一次</span><br><span class="line">     */</span><br><span class="line">    public void increaseWithdrawTimes() &#123;</span><br><span class="line">        withdrawTimes.set(withdrawTimes.get() + 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>DecenterSymbolInfo 类, 用来存储某个交易对(ABC&#x2F;USDT)的Dex配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt; @Date : 2023/3/20 &lt;/p&gt;</span><br><span class="line"> * &lt;p&gt; @Project : block-farming&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt; @author konbluesky &lt;/p&gt;</span><br><span class="line"> */</span><br><span class="line">@Accessors(chain = true)</span><br><span class="line">@Data</span><br><span class="line">@Slf4j</span><br><span class="line">public class DecenterSymbolInfo &#123;</span><br><span class="line"></span><br><span class="line">    private String dexName;</span><br><span class="line"></span><br><span class="line">    private String dexProtocolVersion;</span><br><span class="line"></span><br><span class="line">    public String getSymbol() &#123;</span><br><span class="line">        if(Strings.isNullOrEmpty(middleCoinContractAddress)) &#123;</span><br><span class="line">            return baseCurrency + &quot;/&quot; + quoteCurrency;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return baseCurrency + &quot;/&quot; + middleCurrency + &quot;/&quot; + quoteCurrency;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注意这里是[链上]对应的基础货币 BTC</span><br><span class="line">     */</span><br><span class="line">    private String baseCurrency;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注意这里是[链上]对应的交易对报价货币 USDT</span><br><span class="line">     */</span><br><span class="line">    private String quoteCurrency;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注意这里是[链上]对应的交易对中间报价货币</span><br><span class="line">     */</span><br><span class="line">    private String middleCurrency;</span><br><span class="line"></span><br><span class="line">    private Set&lt;Integer&gt; chainIds;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * TODO 未来需要支持一个币种在多个链上的支持, 目前只考虑币种只在一个链上活跃</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Integer getFirstChainId()&#123;</span><br><span class="line">        return chainIds.iterator().next();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**************************************************************************************************/</span><br><span class="line">    /************************************** 链上的地址配置信息 *******************************************/</span><br><span class="line">    /**************************************************************************************************/</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 为了方便存取,围绕token,将常用的信息包装起来</span><br><span class="line">     */</span><br><span class="line">    private CurrencyBag stable;</span><br><span class="line"></span><br><span class="line">    private CurrencyBag trade;</span><br><span class="line"></span><br><span class="line">    private CurrencyBag middle;</span><br><span class="line"></span><br><span class="line">    public void init() &#123;</span><br><span class="line">        if (stable == null) &#123;</span><br><span class="line">            stable = CurrencyBag.of(stableCoinContractAddress, quoteCurrency, getStableCoinDecimals());</span><br><span class="line">        &#125;</span><br><span class="line">        if (trade == null) &#123;</span><br><span class="line">            trade = CurrencyBag.of(tradeCoinContractAddress, baseCurrency, getTradeCoinDecimals());</span><br><span class="line">        &#125;</span><br><span class="line">        if (middle == null) &#123;</span><br><span class="line">            middle = CurrencyBag.of(middleCoinContractAddress, middleCurrency, getMiddleCoinDecimals());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 稳定币的合约地址</span><br><span class="line">     * USTD,ETH,BTC 等</span><br><span class="line">     */</span><br><span class="line">    private String stableCoinContractAddress;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 中间币的合约地址</span><br><span class="line">     * BNB 有自己独立的链的等</span><br><span class="line">     */</span><br><span class="line">    private String middleCoinContractAddress;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易币的合约地址</span><br><span class="line">     * 即最终操作的目标币地址</span><br><span class="line">     * 原代码中的:swapCoinContractAdd</span><br><span class="line">     */</span><br><span class="line">    private String tradeCoinContractAddress;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * v3流通性的合约地址</span><br><span class="line">     */</span><br><span class="line">    private String v3LoopContractAddress;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * v3手续费的</span><br><span class="line">     */</span><br><span class="line">    private String v3Fee;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 去中心化交易所的合约地址</span><br><span class="line">     */</span><br><span class="line">    private String swapContractAddress;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 反向套利，从蛋糕到交易所，稳定币额度</span><br><span class="line">     * bnb对就进行交易所价格查询，转换成对应的bnb</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     *     声明 BidDepths,bidOnePrice,BidDepthsAllAmount;</span><br><span class="line">     *     swapStableCoinNumOut =  bidOnePrice * BidDepthsAllAmount;</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private AtomicDouble swapStableCoinNumOut;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 非稳定币的兑换数量,个数</span><br><span class="line">     */</span><br><span class="line">    private AtomicDouble swapFStableCoinNum;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 稳定币的兑换数量,个数</span><br><span class="line">     */</span><br><span class="line">    private AtomicDouble swapStableCoinNum;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 价格精度 最小就是0.0001</span><br><span class="line">     */</span><br><span class="line">    private String priceDecimals;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 数量精度 最小就是0.01</span><br><span class="line">     */</span><br><span class="line">    private String numDecimals;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 卖时燃烧的手续费</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal burnFee;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 其他费用，初步用来保存转移费用，有些币种的转移费用</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal otherFee = BigDecimal.ZERO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 链上买币滑点</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal dexBuySlipPoint;</span><br><span class="line"></span><br><span class="line">    private BigDecimal _origin_dexBuySlipPoint;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 买时 税率</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal buyTax = BigDecimal.ZERO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 卖时 税率</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal sellTax = BigDecimal.ZERO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交易币的精度,在程序启动时通过TokenClient从链上合约中查询</span><br><span class="line">     */</span><br><span class="line">    private int tradeCoinDecimals = 0;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 稳定币的精度,在程序启动时通过TokenClient从链上合约中查询</span><br><span class="line">     */</span><br><span class="line">    private int stableCoinDecimals = 0;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 中间币的精度,在程序启动时通过TokenClient从链上合约中查询</span><br><span class="line">     */</span><br><span class="line">    private int middleCoinDecimals = 0;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 链上固定最大下单金额(usdt为单位)</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal dexMaxOrderForUSDT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 链上固定最小下单金额(usdt为单位)</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal dexMinOrderForUSDT;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * dex购买状态，用于判断是否蛋糕买了，然后回交易所</span><br><span class="line">     * 对于这种情况，要进行停止蛋糕购买及交易所到蛋糕的业务</span><br><span class="line">     * 根据交易所充值到账时间 一般需要2分钟，即120秒，那130秒内都必须把价格降</span><br><span class="line">     */</span><br><span class="line">    private AtomicLong dexBuyTimestamp = new AtomicLong(0);</span><br><span class="line"></span><br><span class="line">    private String method;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 反向套利时，需要监控买盘的数据， 这是买盘的位置</span><br><span class="line">     * 对应的是centerSymbolInfo的askPosition</span><br><span class="line">     */</span><br><span class="line">    private int buyPosition;</span><br><span class="line">    /**</span><br><span class="line">     * 反向套利时，深度需要*depthPro ，进行打折</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal depthPro;</span><br><span class="line"></span><br><span class="line">    public DecenterSymbolInfo setDexBuySlipPoint(BigDecimal dexBuySlipPoint) &#123;</span><br><span class="line">        this.dexBuySlipPoint = dexBuySlipPoint;</span><br><span class="line">        // 保留原始值用于恢复</span><br><span class="line">        this._origin_dexBuySlipPoint = dexBuySlipPoint;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ExtensionDexHandlerConfig extensionDexHandlerConfig;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 反向套利时的放大比例</span><br><span class="line">     */</span><br><span class="line">    private BigDecimal replyPro;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public boolean isV3()&#123;</span><br><span class="line">        return getDexProtocolVersion().toLowerCase().contains(&quot;v3&quot;.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line">    public boolean isV2()&#123;</span><br><span class="line">        return getDexProtocolVersion().toLowerCase().contains(&quot;v2&quot;.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 对dexBuySlipPoint滑点1.5倍；</span><br><span class="line">     */</span><br><span class="line">    public void setDexBuySlipPointDouble() &#123;</span><br><span class="line">        dexBuySlipPoint = dexBuySlipPoint.multiply(replyPro);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void resetDexBuySlipPoint() &#123;</span><br><span class="line">        dexBuySlipPoint = _origin_dexBuySlipPoint;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>Carry-Coin 架构设计 SymbolLedger (4)</p><p><a href="https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/">https://konbluesky.github.io/2024/11/05/carry_coin_architecture_4/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Gavin</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-11-05</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-11-05</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Java/">Java</a><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a><a class="link-muted mr-2" rel="tag" href="/tags/Architecture/">Architecture</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6710ab63d01e2b00125525b8&amp;product=inline-share-buttons&amp;source=platform" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/11/09/hummingbot_info/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Hummingbot：开源的加密货币高频交易机器人</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/11/03/google-2fa/"><span class="level-item">Google 2FA 脚本</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "1360cc96e102fb70028e809c1884c9e2",
            repo: "konbluesky.github.io.comment",
            owner: "konbluesky",
            clientID: "Ov23li3Uf3bRbNrEKuYE",
            clientSecret: "60f3d2bea2f29855b6fa26671e08d3ea8bf8e290",
            admin: ["konbluesky"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/apple-touch-icon.png" alt="Gavin"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gavin</p><p class="is-size-6 is-block">Full-Stack Engineer &amp; Web3 Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ZheJiang, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives/"><p class="title">26</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories/"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags/"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/konbluesky" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/konbluesky"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com/blackjackhoho"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/konbluesky" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://my.oschina.net/u/261246" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">OsChina</span></span><span class="level-right"><span class="level-item tag">my.oschina.net</span></span></a></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">January 2025</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">December 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">November 2024</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">February 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Architecture/"><span class="tag">Architecture</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Freebie-hunting/"><span class="tag">Freebie hunting</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HummingBot/"><span class="tag">HummingBot</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IC/"><span class="tag">IC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Internet-Computer/"><span class="tag">Internet Computer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Jetcache/"><span class="tag">Jetcache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bsc/"><span class="tag">bsc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jasypt/"><span class="tag">jasypt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/miniconda/"><span class="tag">miniconda</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/optimization/"><span class="tag">optimization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zsh/"><span class="tag">zsh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86/"><span class="tag">日志清理</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CarryCoin/"><span class="level-start"><span class="level-item">CarryCoin</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Freebie-hunting/"><span class="level-start"><span class="level-item">Freebie hunting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/HummingBot/"><span class="level-start"><span class="level-item">HummingBot</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-20T07:26:12.000Z">2025-01-20</time></p><p class="title"><a href="/2025/01/20/python_networkx/">python networkx</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-14T01:18:45.000Z">2025-01-14</time></p><p class="title"><a href="/2025/01/14/python_py_spy/">python 性能分析</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-21T19:53:42.000Z">2024-12-22</time></p><p class="title"><a href="/2024/12/22/freebie_hunting_bera_chain/">撸毛 Bera 圣诞节</a></p><p class="categories"><a href="/categories/Freebie-hunting/">Freebie hunting</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-19T15:45:22.000Z">2024-12-19</time></p><p class="title"><a href="/2024/12/19/jetcache-integration/">OO模块集成 Jetcache 缓存问题</a></p><p class="categories"><a href="/categories/Spring/">Spring</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-10T15:37:45.000Z">2024-12-10</time></p><p class="title"><a href="/2024/12/10/ic_hello/">Internet Computer (IC)</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Gavin&#039;s Home</a><p class="is-size-7"><span>&copy; 2025 Gavin</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>